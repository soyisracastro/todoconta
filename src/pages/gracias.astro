---
import LandingLayout from '../layouts/LandingLayout.astro';
---

<LandingLayout title="¡Gracias por tu compra!" description="Tu pago ha sido procesado exitosamente">
  <section class="section bg-warm">
    <div class="container text-center">
      <!-- Success Icon -->
      <div class="mb-8">
        <div class="success-icon">
          <svg class="success-checkmark" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
          </svg>
        </div>
        <h1 class="section-title">¡Pago Exitoso!</h1>
        <p class="lead">
          Gracias por tu compra. Hemos procesado tu pago correctamente.
        </p>
      </div>

      <!-- Order Details -->
      <div class="card">
        <h2 class="card-title" style="text-align: center; margin-bottom: var(--space-6);">Detalles de tu compra</h2>

        <div class="order-details">
          <div class="order-row">
            <span class="order-label">Producto:</span>
            <span class="order-value" id="product-name">Cargando...</span>
          </div>

          <div class="order-row">
            <span class="order-label">Plan:</span>
            <span class="order-value" id="plan-name">Cargando...</span>
          </div>

          <div class="order-row">
            <span class="order-label">ID de Transacción:</span>
            <span class="order-value order-id" id="transaction-id">
              Cargando...
            </span>
          </div>
        </div>
      </div>

      <!-- Email Confirmation -->
      <div class="success-message mb-8" style="max-width: 600px; margin: 0 auto;">
        <div class="flex items-center mb-4">
          <svg class="email-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
          </svg>
          <h3 class="success-title">Revisa tu correo electrónico</h3>
        </div>
        <p class="success-text">
          En los próximos minutos recibirás un correo electrónico con:
        </p>
        <ul class="success-list">
          <li>Instrucciones de activación o descarga</li>
          <li>Información detallada de tu compra</li>
          <li>Enlaces de soporte técnico</li>
        </ul>
      </div>

      <!-- Action Buttons -->
      <div class="flex flex-col gap-4 items-center" style="max-width: 400px; margin: 0 auto;">
        <a href="/" class="btn btn-primary btn-lg" style="width: 100%;">
          Volver al Inicio
        </a>

        <a href="/contacto" class="btn btn-outline btn-lg" style="width: 100%;">
          Contactar Soporte
        </a>
      </div>

      <!-- Help Text -->
      <div class="help-text">
        <p>
          ¿No recibiste el correo? Revisa tu carpeta de spam o
          <a href="/contacto">contáctanos</a>
          para recibir asistencia.
        </p>
      </div>
    </div>
  </section>
</LandingLayout>

<style>
  /* Success Icon Styles */
  .success-icon {
    width: 96px;
    height: 96px;
    background: var(--color-success);
    border-radius: var(--border-radius-full);
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto var(--space-6);
    box-shadow: var(--shadow-success);
  }

  .success-checkmark {
    width: 48px;
    height: 48px;
    color: var(--color-white);
    stroke-width: 3;
  }

  .card {
    padding: var(--space-6);
    max-width: 600px;
    margin: 0 auto var(--space-8);
  }

  /* Order Details Styles */
  .order-details {
    display: flex;
    flex-direction: column;
    gap: var(--space-4);
  }

  .order-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--space-3) 0;
    border-bottom: 1px solid var(--color-border-light);
  }

  .order-row:last-child {
    border-bottom: none;
  }

  .order-label {
    font-weight: 600;
    color: var(--color-text-primary);
  }

  .order-value {
    color: var(--color-text-primary);
    text-align: right;
  }

  .order-id {
    font-family: var(--font-mono);
    font-size: var(--font-size-sm);
    background: var(--color-background-alt);
    padding: var(--space-1) var(--space-2);
    border-radius: var(--border-radius-sm);
    word-break: break-all;
  }

  /* Success Message Styles */
  .success-message {
    background: rgba(129, 178, 154, 0.1);
    border: 1px solid rgba(129, 178, 154, 0.2);
    border-radius: var(--border-radius-lg);
    padding: var(--space-6);
    text-align: left;
  }

  .success-title {
    color: var(--color-success);
    margin: 0 0 var(--space-3) 0;
    font-size: var(--font-size-lg);
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: var(--space-3);
  }

  .email-icon {
    width: 24px;
    height: 24px;
    color: var(--color-success);
    flex-shrink: 0;
  }

  .success-text {
    color: var(--color-success);
    margin: 0 0 var(--space-4) 0;
    line-height: 1.6;
  }

  .success-list {
    color: var(--color-success);
    margin: 0;
    padding-left: var(--space-6);
    list-style-type: disc;
  }

  .success-list li {
    margin-bottom: var(--space-2);
    line-height: 1.5;
  }

  /* Help Text Styles */
  .help-text {
    margin-top: var(--space-12);
    color: var(--color-text-secondary);
    font-size: var(--font-size-sm);
    text-align: center;
  }

  .help-text a {
    color: var(--color-primary);
    font-weight: 500;
  }

  .help-text a:hover {
    color: var(--color-primary-hover);
  }

  /* Responsive Design */
  @media (max-width: 768px) {
    .success-icon {
      width: 72px;
      height: 72px;
    }

    .success-checkmark {
      width: 36px;
      height: 36px;
    }

    .order-row {
      flex-direction: column;
      align-items: flex-start;
      gap: var(--space-1);
    }

    .order-value {
      text-align: left;
    }

    .success-title {
      font-size: var(--font-size-base);
    }

    .email-icon {
      width: 20px;
      height: 20px;
    }
  }

  @media (max-width: 480px) {
    .section {
      padding: var(--space-12) 0;
    }

    .card {
      margin: 0 var(--space-4);
    }

    .success-message {
      margin: 0 var(--space-4);
    }
  }
</style>

<script>
  // Load product details dynamically
  function loadProductDetails() {
    const urlParams = new URLSearchParams(window.location.search);
    const productSlug = urlParams.get('product');
    const planId = urlParams.get('plan');
    const sessionId = urlParams.get('session_id');

    console.log('Loading product details:', { productSlug, planId, sessionId });

    if (productSlug) {
      try {
        // Product name mapping
        const productNames = {
          'xmlsat': 'XMLSAT++',
          'xmlsat-premium': 'XMLSAT Premium',
          'plantilla-carga-batch-diot': 'Carga Batch DIOT 2025',
          'control-xml-nomina': 'Control XML Nómina - Plantilla Excel para Manejo de CFDI de Nómina',
          'centinela-xpress': 'CENTINELA XPRESS'
        };

        const productName = productNames[productSlug] || 'Producto Digital';
        const productNameElement = document.getElementById('product-name');

        if (productNameElement) {
          productNameElement.textContent = productName;
          console.log('Product name set:', productName);
        } else {
          console.warn('Product name element not found');
        }

        if (planId) {
          // Plan name mapping
          const planNames = {
            '1-licencia': '1 Licencia',
            '3-licencias': '3 Licencias',
            '5-licencias': '5 Licencias',
            'single': 'Licencia Individual',
            '1': '1 Licencia',
            '3': '3 Licencias',
            '5': '5 Licencias'
          };

          const planName = planNames[planId] || planId;
          const planNameElement = document.getElementById('plan-name');

          if (planNameElement) {
            planNameElement.textContent = planName;
            console.log('Plan name set:', planName);
          } else {
            console.warn('Plan name element not found');
          }
        }

        // Set transaction ID if available
        if (sessionId) {
          const transactionElement = document.getElementById('transaction-id');
          if (transactionElement) {
            transactionElement.textContent = sessionId;
            console.log('Transaction ID set:', sessionId);
          }
        }

      } catch (error) {
        console.error('Error loading product details:', error);

        // Fallback: set default values
        const productNameElement = document.getElementById('product-name');
        const planNameElement = document.getElementById('plan-name');

        if (productNameElement) productNameElement.textContent = 'Producto Digital';
        if (planNameElement) planNameElement.textContent = 'Licencia Individual';
      }
    } else {
      console.warn('No product slug provided');
    }
  }

  // Load details immediately if DOM is ready, otherwise wait
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', loadProductDetails);
  } else {
    loadProductDetails();
  }

  // Also try to load after a short delay as backup
  setTimeout(loadProductDetails, 100);
</script>